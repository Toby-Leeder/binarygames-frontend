<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="racerStyles.css">
  </head>
  <body>
    <div class="wrapper">
      <div class="menu">
        <div class="menu-title" >B1NARY RACER тквтквткв</div>
        <div class="menu-button">Back to Escape Room</div>
      </div>
      <div class="splash">
        <h1 class = "splash-header">click here to start</h1>
      </div>
      <div class="traffic-light" id="traffic-light">
        <div class="light red"></div>
        <div class="light yellow"></div>
        <div class="light green"></div> 
      </div>
      <div id="end-screen" style="display: none;">
        <p>Time taken: <span id="end-time"></span></p>
      </div>
      <div id="game">
      <div class="top-container">
        <p>
          <div class="questions-completed">QUESTIONS COMPLETED: </div>
          <div id="questions" class="questions-completed"> 0</div>
          <div class="questions-completed">/ 10</div>
          <div class="time-container">
            <div class="time-elapsed">TIME : </div> 
            <div class="time-elapsed" id="seconds">00 :</div> 
            <div class="time-elapsed" id="mins">00</div>
          </div>
        </p>
      </div>
      <div class="progressbar">
        <div class="inner"></div>
      </div>
      <div class="image-container">
        <img src="images/BRG_road.png" alt="road">
        <div class="lines-body"></div>
        <canvas id="spriteContainer" class="carContainer">
          <img class="car1" id ="car" src="images/carSprites.png">
        </canvas>
      </div>
      <div class="bottom-UI">
        <div class="questions-given" id="questions-container"> QUESTIONS HERE</div>
        <div class="button-container">
          <button class="answer-button1" id="answer-button1">-</button>
          <button class="answer-button2" id="answer-button2">-</button>
          <button class="answer-button3" id="answer-button3">-</button>
          <button class="answer-button4" id="answer-button4">-</button>
        </div>
      </div>
      <div id='progressbar'></div>
      </div>
      </div>
  </body>
  <script>    
    // traffic lights
    function activateLights() {
      var lights = document.getElementsByClassName('light');
      
      for (var i = 0; i < lights.length; i++) {
        lights[i].classList.remove('active');
      }
      
      var activeLight = lights[0];
      activeLight.classList.add('active');
      
      setInterval(function() {
        activeLight.classList.remove('active');
        activeLight = activeLight.nextElementSibling || lights[0];
        activeLight.classList.add('active');
      }, 1000);
    }
    
 
      const progressBar = document.querySelector(".progressbar .inner");
      const car1 = document.querySelector(".car1");
      const startButton = document.querySelector("#start-button");
      const button1 = document.querySelector("#answer-button1");
      const game = document.getElementById("game")
      const trafficLight = document.getElementById("traffic-light")

      let seconds = 0;
      let mins = 0;
      let questions = 0;
      const appendMins = document.getElementById("mins");
      let Interval;
      const appendSeconds = document.getElementById("seconds");
      const appendQ = document.getElementById("questions");
      const newQuestion = document.getElementById('questions-container')
      var splashScreen = document.querySelector('.splash');

      window.addEventListener("load", () => {
          game.style.visibility = "hidden";
          document.getElementById("traffic-light").style.display = "visible";
      });

      splashScreen.addEventListener('click',()=> {
          splashScreen.style.opacity = 0;
          setTimeout(()=>{
            splashScreen.classList.add('hidden')
          },610)
          car1.style.animationName = "moveRight";
          car1.style.animationPlayState = "running";
          setTimeout(function() {
            car1.style.animationPlayState = "paused";
          }, 500);
          activateLights();
          setTimeout(function() {
            document.getElementById("traffic-light").style.display = "none";
            game.style.visibility = "visible";
            clearInterval(Interval);
            Interval = setInterval(startTimer, 10);
          }, 3000); 
      })


      let keyframeIndex = 0;
      function barMove() {
        if (keyframeIndex < 10) { // limit to 10 keyframes
          const animationDuration = 5;
          progressBar.style.animation = `progressbar-countdown ${animationDuration}s forwards`;
          progressBar.style.animationPlayState = "running";
          progressBar.style.animationIterationCount = 1;
          progressBar.style.animationTimingFunction = "linear";
          progressBar.style.width = `${(keyframeIndex + 1) * 10}%`;
          setTimeout(function() {
            progressBar.style.animationPlayState = "paused";
          }, 500); 
          keyframeIndex++;
        }
        addQuestion();
      }


      function startTimer () {
        mins++; 
        if(mins <= 9){
          appendMins.innerHTML = "0" + mins;
        }
        if (mins > 9){
          appendMins.innerHTML = mins;
        } 
        if (mins > 99) {
          console.log("seconds");
          seconds++;
          appendSeconds.innerHTML = "0" + seconds;
          mins = 0;
          appendMins.innerHTML = "0" + 0;
        }
        if (seconds > 9){
          appendSeconds.innerHTML = seconds;
        }
      }

    
    function showEndScreen() {
      clearInterval(Interval);
      const endTime = document.getElementById("end-time");
      endTime.textContent = appendSeconds.innerHTML + ":" + appendMins.innerHTML;
      game.style.visibility = "hidden";
      const endScreen = document.getElementById("end-screen");
      endScreen.style.display = "block";
    }

      function addQuestion () { 
        questions++;
        appendQ.innerHTML = questions;
        if (questions > 10) {
            questions = 10;
            appendQ.innerHTML = questions;
        }
        if (questions === 10) {
          showEndScreen();
        }
      }

      
      // start of questions and answers code
      const option1 = document.getElementById("answer-button1"),
      option2 = document.getElementById("answer-button2"),
      option3 = document.getElementById("answer-button3"),
      option4 = document.getElementById("answer-button4");
      function generate_equation() {
        console.log('here')
        var num1 = Math.floor(Math.random() * 9),
        num2 = Math.floor(Math.random() * 9),
        binary1 = num1.toString(2).padStart(4, '0'),
        binary2 = num2.toString(2).padStart(4, '0');
        
        var choice1 = Math.floor(Math.random() * 9),
        binchoice1 = choice1.toString(2).padStart(4, '0'),
        choice2 = Math.floor(Math.random() * 9),
        binchoice2 = choice2.toString(2).padStart(4, '0'),
        choice3 = Math.floor(Math.random() * 9),
        binchoice3 = choice3.toString(2).padStart(4, '0'),
        allAnswers = [],
        switchAnswers = [];
      
        answer = eval(num1 + num2);
        binanswer = answer.toString(2).padStart(4, '0')
      
        //document.getElementById("num1").innerHTML = num1; 
        //document.getElementById("num2").innerHTML = num2; 
      
        newQuestion.innerHTML = "What is " + binary1 + " + " + binary2;
      
        allAnswers = [binanswer, binchoice1, binchoice2, binchoice3];
        
        for (i = allAnswers.length; i--;) {
          switchAnswers.push(allAnswers.splice(Math.floor(Math.random() * (i + 1)), 1)[0]);
        };
        
        option1.innerHTML = switchAnswers[0];
        option2.innerHTML = switchAnswers[1];
        option3.innerHTML = switchAnswers[2]; 
        option4.innerHTML = switchAnswers[3];
      };
      
          option1.addEventListener("click", function(){
            const selectedAnswer = parseInt(option1.innerHTML, 2);
            if(selectedAnswer == answer){
              barMove();
              generate_equation();
            }
            else{
              console.log(`Incorrect`)
            }
          });
          
          option2.addEventListener("click", function(){
            const selectedAnswer = parseInt(option2.innerHTML, 2);
            if(selectedAnswer == answer){
              barMove();
              generate_equation();
            }
            else{
              console.log(`Incorrect`)
            }
          });
          
          option3.addEventListener("click", function(){
            const selectedAnswer = parseInt(option3.innerHTML, 2);
            if(selectedAnswer == answer){
              barMove();
              generate_equation();
            }
            else{
              console.log(`Incorrect`)
            }
          });
          
          option4.addEventListener("click", function(){
            const selectedAnswer = parseInt(option4.innerHTML, 2);
            if(selectedAnswer == answer){
              barMove();
              generate_equation();
          }
          else{
            console.log(`Incorrect`)
          }
          });

generate_equation()

window.addEventListener('load', function(){
  const canvas = document.getElementById('spriteContainer');
  const ctx = canvas.getContext('2d');
  canvas.width = 240;
  canvas.height = 180; 

  class Car {
      constructor(){ 
          this.image = document.getElementById("car")
          this.spriteWidth = 220;
          this.spriteHeight = 160;
          this.width = this.spriteWidth;
          this.height = this.spriteHeight;
          this.x = 0;
          this.y = 0;
          this.minFrame = 0;
          this.maxFrame = 48;
          this.frameX = 0;
          this.frameY = 0;
      }
      draw(context){
          context.drawImage(this.image, this.frameX * this.spriteWidth, this.frameY * this.spriteHeight, this.spriteWidth, this.spriteHeight, this.x, this.y, this.width, this.height);
      }
      update(){
          if (this.frameX < 15) this.frameX++ 
          else this.frameX = 0;
      }
  }
  const car = new Car();

  function animate(){
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      car.draw(ctx);
      car.update();
      requestAnimationFrame(animate);
  }
  animate();
});

  </script>
</html>